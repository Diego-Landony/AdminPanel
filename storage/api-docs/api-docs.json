{
    "openapi": "3.0.0",
    "info": {
        "title": "Subway Guatemala Customer API",
        "description": "API REST para la aplicación móvil de clientes de Subway Guatemala. Incluye autenticación multi-canal (email/password y Google OAuth), gestión de perfil, dispositivos FCM para notificaciones push y futuras funcionalidades de pedidos y lealtad.",
        "contact": {
            "email": "dev@subwayguatemala.com"
        },
        "version": "1.0.2"
    },
    "servers": [
        {
            "url": "http://localhost:8000",
            "description": "Local Development Server"
        },
        {
            "url": "http://localhost",
            "description": "Application Server"
        }
    ],
    "paths": {
        "/api/v1/auth/register": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Register a new customer",
                "description": "Creates a new customer account with email and password. Sends email verification notification.",
                "operationId": "7ca6fc7989202054d29707fef91a2d4a",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "first_name",
                                    "last_name",
                                    "email",
                                    "password",
                                    "password_confirmation",
                                    "device_identifier"
                                ],
                                "properties": {
                                    "first_name": {
                                        "description": "Customer first name",
                                        "type": "string",
                                        "example": "Juan"
                                    },
                                    "last_name": {
                                        "description": "Customer last name",
                                        "type": "string",
                                        "example": "Pérez"
                                    },
                                    "email": {
                                        "description": "Valid email address",
                                        "type": "string",
                                        "format": "email",
                                        "example": "juan@example.com"
                                    },
                                    "password": {
                                        "description": "Min 6 characters, 1 letter, 1 number",
                                        "type": "string",
                                        "format": "password",
                                        "example": "Pass123"
                                    },
                                    "password_confirmation": {
                                        "description": "Must match password",
                                        "type": "string",
                                        "format": "password",
                                        "example": "Pass123"
                                    },
                                    "phone": {
                                        "description": "Optional phone number",
                                        "type": "string",
                                        "example": "+50212345678",
                                        "nullable": true
                                    },
                                    "birth_date": {
                                        "description": "Optional birth date",
                                        "type": "string",
                                        "format": "date",
                                        "example": "1990-05-15",
                                        "nullable": true
                                    },
                                    "gender": {
                                        "description": "Optional gender",
                                        "type": "string",
                                        "enum": [
                                            "male",
                                            "female",
                                            "other"
                                        ],
                                        "example": "male",
                                        "nullable": true
                                    },
                                    "device_identifier": {
                                        "description": "REQUIRED: Unique device UUID for tracking",
                                        "type": "string",
                                        "example": "550e8400-e29b-41d4-a716-446655440000"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Registration successful",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Registro exitoso. Por favor verifica tu email."
                                        },
                                        "data": {
                                            "properties": {
                                                "customer": {
                                                    "$ref": "#/components/schemas/Customer"
                                                },
                                                "token": {
                                                    "type": "string",
                                                    "example": "1|abc123xyz..."
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Validation error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Este correo ya está registrado."
                                        },
                                        "errors": {
                                            "properties": {
                                                "email": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "string",
                                                        "example": "Este correo ya está registrado."
                                                    }
                                                },
                                                "first_name": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "string",
                                                        "example": "El nombre es requerido."
                                                    }
                                                },
                                                "last_name": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "string",
                                                        "example": "El apellido es requerido."
                                                    }
                                                },
                                                "password": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "string",
                                                        "example": "Las contraseñas no coinciden."
                                                    }
                                                },
                                                "phone": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "string",
                                                        "example": "El teléfono debe tener exactamente 8 dígitos."
                                                    }
                                                },
                                                "birth_date": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "string",
                                                        "example": "La fecha de nacimiento es requerida."
                                                    }
                                                },
                                                "gender": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "string",
                                                        "example": "El género es requerido."
                                                    }
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "429": {
                        "description": "Too many requests"
                    }
                }
            }
        },
        "/api/v1/auth/login": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Login with email and password",
                "description": "Authenticates customer and returns Sanctum token. Rate limited to 5 attempts per minute.",
                "operationId": "9d0bb5c770cbec19b0b9566606ef4adb",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email",
                                    "password",
                                    "device_identifier"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "juan@example.com"
                                    },
                                    "password": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "SecurePass123!"
                                    },
                                    "device_identifier": {
                                        "description": "REQUIRED: Unique device UUID for tracking",
                                        "type": "string",
                                        "example": "550e8400-e29b-41d4-a716-446655440000"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Login successful",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Inicio de sesión exitoso."
                                        },
                                        "data": {
                                            "properties": {
                                                "customer": {
                                                    "$ref": "#/components/schemas/Customer"
                                                },
                                                "token": {
                                                    "type": "string",
                                                    "example": "1|abc123xyz..."
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Invalid credentials or OAuth account",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Las credenciales proporcionadas son incorrectas."
                                        },
                                        "errors": {
                                            "properties": {
                                                "email": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "string",
                                                        "example": "Las credenciales proporcionadas son incorrectas."
                                                    }
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "429": {
                        "description": "Too many login attempts"
                    }
                }
            }
        },
        "/api/v1/auth/logout": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Logout from current device",
                "description": "Revokes the current access token. Other devices remain logged in.",
                "operationId": "3a27a9e02ceb521eb3f98c8d2394aef9",
                "responses": {
                    "200": {
                        "description": "Logout successful",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Sesión cerrada exitosamente."
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/v1/auth/logout-all": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Logout from all devices",
                "description": "Revokes all access tokens. Customer will be logged out from all devices.",
                "operationId": "afe5fcc3199730bf8caf978b67c6a0c0",
                "responses": {
                    "200": {
                        "description": "Logout successful",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Se cerraron todas las sesiones exitosamente."
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/v1/auth/refresh": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Refresh access token",
                "description": "Generates new access token and revokes the old one. Token rotation for security.",
                "operationId": "437b695fba1c5eecef1841f958322adc",
                "responses": {
                    "200": {
                        "description": "Token refreshed successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Token renovado exitosamente."
                                        },
                                        "data": {
                                            "properties": {
                                                "token": {
                                                    "type": "string",
                                                    "example": "2|xyz456abc..."
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/v1/auth/forgot-password": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Request password reset",
                "description": "Sends password reset link to customer's email. Only for local accounts (not OAuth).",
                "operationId": "4011ca27431b5cd53a225688e531de47",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "juan@example.com"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Reset link sent",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Enlace de restablecimiento de contraseña enviado."
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Validation error"
                    },
                    "429": {
                        "description": "Too many requests"
                    }
                }
            }
        },
        "/api/v1/auth/reset-password": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Reset password",
                "description": "Resets password using token from email. Revokes all existing tokens for security.",
                "operationId": "aba7a33c4064b5b1a2f3a8a70c20094b",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email",
                                    "password",
                                    "password_confirmation",
                                    "token"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "juan@example.com"
                                    },
                                    "password": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "NewSecurePass123!"
                                    },
                                    "password_confirmation": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "NewSecurePass123!"
                                    },
                                    "token": {
                                        "type": "string",
                                        "example": "abc123resettoken456"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Password reset successful",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Contraseña restablecida exitosamente."
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Invalid token or validation error"
                    },
                    "429": {
                        "description": "Too many requests"
                    }
                }
            }
        },
        "/api/v1/auth/email/verify/{id}/{hash}": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Verify email address",
                "description": "Verifies customer email using signed URL from verification email.",
                "operationId": "1cd7d201c16988ffdc55af25262f9ac8",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "Customer ID",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    },
                    {
                        "name": "hash",
                        "in": "path",
                        "description": "Email hash for verification",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Email verified successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Email verificado exitosamente."
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Invalid verification link"
                    },
                    "429": {
                        "description": "Too many requests"
                    }
                }
            }
        },
        "/api/v1/auth/email/resend": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Resend verification email",
                "description": "Sends a new verification email to the customer.",
                "operationId": "f07474133b03f2e2f82012253317a15f",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "juan@example.com"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Verification email sent",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Enlace de verificación reenviado."
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Email not found or already verified"
                    },
                    "429": {
                        "description": "Too many requests"
                    }
                }
            }
        },
        "/api/v1/auth/oauth/google/redirect": {
            "get": {
                "tags": [
                    "OAuth"
                ],
                "summary": "Redirect to Google OAuth (Web & Mobile)",
                "description": "Initiates Google OAuth flow for any platform. Uses OAuth 2.0 state parameter to maintain context across the redirect flow. Works for web apps, mobile apps (React Native with WebBrowser), and any other client type. After Google authorization, redirects to callback which returns JSON for web or deep link for mobile.",
                "operationId": "d45644767bd0769d1084909175bff619",
                "parameters": [
                    {
                        "name": "action",
                        "in": "query",
                        "description": "Action type: 'login' for existing users or 'register' for new users",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "login",
                                "register"
                            ],
                            "example": "login"
                        }
                    },
                    {
                        "name": "platform",
                        "in": "query",
                        "description": "Client platform: 'web' for web applications (returns JSON) or 'mobile' for mobile apps (redirects via deep link)",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "web",
                                "mobile"
                            ],
                            "example": "web"
                        }
                    },
                    {
                        "name": "device_id",
                        "in": "query",
                        "description": "Device identifier UUID for tracking. **REQUIRED when platform=mobile**, optional for web. Validated with rule: required_if:platform,mobile",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "example": "550e8400-e29b-41d4-a716-446655440000"
                        }
                    }
                ],
                "responses": {
                    "302": {
                        "description": "Redirect to Google OAuth consent screen"
                    },
                    "422": {
                        "description": "Validation error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "The action field is required."
                                        },
                                        "errors": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/v1/auth/oauth/google/callback": {
            "get": {
                "tags": [
                    "OAuth"
                ],
                "summary": "Handle Google OAuth callback (Web & Mobile)",
                "description": "Handles Google OAuth callback after user authorization. This endpoint is called automatically by Google. It decodes the OAuth 2.0 state parameter to determine platform and action, then authenticates or registers the user. For web: redirects to /oauth/success HTML page that stores token in localStorage. For mobile: redirects to deep link with token.",
                "operationId": "281ab9caddb2b86e3614c9e34567db4f",
                "parameters": [
                    {
                        "name": "code",
                        "in": "query",
                        "description": "Authorization code from Google OAuth",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "example": "4/0AY0e-g7..."
                        }
                    },
                    {
                        "name": "state",
                        "in": "query",
                        "description": "OAuth 2.0 state parameter containing encoded platform, action, and device_id information",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "example": "eyJwbGF0Zm9ybSI6IndlYiIsImFjdGlvbiI6ImxvZ2luIn0="
                        }
                    }
                ],
                "responses": {
                    "302": {
                        "description": "Redirect response - behavior depends on platform and success/error status. WEB SUCCESS: redirects to /oauth/success (HTML page that stores token in localStorage and redirects to /home). WEB ERROR: redirects to /login with error message. MOBILE SUCCESS: redirects to subwayapp://oauth/callback?token=xxx&customer_id=xxx. MOBILE ERROR: redirects to subwayapp://oauth/callback?error=xxx&message=xxx",
                        "headers": {
                            "Location": {
                                "description": "Redirect URL varies by platform: Web success -> /oauth/success, Web error -> /login, Mobile success -> subwayapp://oauth/callback?token=..., Mobile error -> subwayapp://oauth/callback?error=...",
                                "schema": {
                                    "type": "string",
                                    "example": "/oauth/success"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/v1/devices": {
            "get": {
                "tags": [
                    "Devices"
                ],
                "summary": "List customer devices",
                "description": "Returns all active devices for authenticated customer. Current device is flagged with is_current_device=true.",
                "operationId": "afcbc146bf93b130969374c0c29f42f6",
                "responses": {
                    "200": {
                        "description": "Devices retrieved successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "data": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/components/schemas/CustomerDevice"
                                            }
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/v1/devices/register": {
            "post": {
                "tags": [
                    "Devices"
                ],
                "summary": "Register or update device",
                "description": "Enriches existing device (auto-created during auth) with FCM token and custom device name. The mobile app MUST send a personalized device name (e.g., 'iPhone 14 Pro de Juan', 'Samsung Galaxy S23 de María') to replace the generic 'Device' name created during authentication. This allows users to identify their devices in the device list.",
                "operationId": "0743195c75a8fccfdf9875291bd6d8c0",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "fcm_token",
                                    "device_identifier",
                                    "device_name"
                                ],
                                "properties": {
                                    "fcm_token": {
                                        "description": "Firebase Cloud Messaging token for push notifications",
                                        "type": "string",
                                        "example": "fKw8h4Xj..."
                                    },
                                    "device_identifier": {
                                        "description": "REQUIRED: Unique device UUID (must match identifier from auth)",
                                        "type": "string",
                                        "example": "550e8400-e29b-41d4-a716-446655440000"
                                    },
                                    "device_name": {
                                        "description": "REQUIRED: Personalized device name set by the app (e.g., 'iPhone 14 Pro de Juan', 'Samsung Galaxy S23 de María'). This name will be displayed to the user when managing their devices.",
                                        "type": "string",
                                        "example": "iPhone 14 Pro de Juan"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Device registered or updated successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Dispositivo registrado exitosamente."
                                        },
                                        "data": {
                                            "$ref": "#/components/schemas/CustomerDevice"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/v1/devices/{device}": {
            "delete": {
                "tags": [
                    "Devices"
                ],
                "summary": "Deactivate device",
                "description": "Marks device as inactive (soft deactivate). Device will no longer receive push notifications.",
                "operationId": "a9545ae592649836835794a3421d3551",
                "parameters": [
                    {
                        "name": "device",
                        "in": "path",
                        "description": "Device ID",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Device deactivated successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Dispositivo desactivado exitosamente."
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "403": {
                        "description": "Forbidden - device belongs to another customer"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/v1/profile": {
            "get": {
                "tags": [
                    "Profile"
                ],
                "summary": "Get customer profile",
                "description": "Returns authenticated customer profile with addresses, NITs, and active devices.",
                "operationId": "dffac35700b3186de8d19cc212fe0285",
                "responses": {
                    "200": {
                        "description": "Profile retrieved successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "data": {
                                            "properties": {
                                                "customer": {
                                                    "$ref": "#/components/schemas/Customer"
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            },
            "put": {
                "tags": [
                    "Profile"
                ],
                "summary": "Update customer profile",
                "description": "Updates customer profile information. If email is changed, marks email as unverified.",
                "operationId": "d682da2fd566e34f597e169ac582ad3f",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "first_name": {
                                        "type": "string",
                                        "example": "Juan"
                                    },
                                    "last_name": {
                                        "type": "string",
                                        "example": "Pérez Actualizado"
                                    },
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "nuevo@example.com"
                                    },
                                    "phone": {
                                        "type": "string",
                                        "example": "+50212345678",
                                        "nullable": true
                                    },
                                    "birth_date": {
                                        "type": "string",
                                        "format": "date",
                                        "example": "1990-05-15",
                                        "nullable": true
                                    },
                                    "gender": {
                                        "type": "string",
                                        "enum": [
                                            "male",
                                            "female",
                                            "other"
                                        ],
                                        "example": "male",
                                        "nullable": true
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Profile updated successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Perfil actualizado exitosamente."
                                        },
                                        "data": {
                                            "properties": {
                                                "customer": {
                                                    "$ref": "#/components/schemas/Customer"
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            },
            "delete": {
                "tags": [
                    "Profile"
                ],
                "summary": "Delete customer account",
                "description": "Soft deletes customer account. Requires password confirmation for local accounts. Revokes all tokens.",
                "operationId": "dd388e266427403d3d4573c1104c784a",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "password"
                                ],
                                "properties": {
                                    "password": {
                                        "description": "Current password for verification",
                                        "type": "string",
                                        "format": "password",
                                        "example": "SecurePass123!"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Account deleted successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Cuenta eliminada exitosamente."
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "422": {
                        "description": "Incorrect password"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/v1/profile/avatar": {
            "post": {
                "tags": [
                    "Profile"
                ],
                "summary": "Update customer avatar",
                "description": "Updates customer avatar URL. Can be a URL to uploaded image or OAuth provider avatar.",
                "operationId": "b67e208bcaefaa8d266a90398752d0c6",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "avatar"
                                ],
                                "properties": {
                                    "avatar": {
                                        "description": "Avatar URL",
                                        "type": "string",
                                        "example": "https://example.com/avatar.jpg"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Avatar updated successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Avatar actualizado exitosamente."
                                        },
                                        "data": {
                                            "properties": {
                                                "avatar": {
                                                    "type": "string",
                                                    "example": "https://example.com/avatar.jpg"
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            },
            "delete": {
                "tags": [
                    "Profile"
                ],
                "summary": "Delete customer avatar",
                "description": "Removes customer avatar. Sets avatar to null.",
                "operationId": "c62431c4a1d50a4ac550be7c4bf25477",
                "responses": {
                    "200": {
                        "description": "Avatar deleted successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Avatar eliminado exitosamente."
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/v1/profile/password": {
            "put": {
                "tags": [
                    "Profile"
                ],
                "summary": "Update customer password",
                "description": "Changes customer password. Only for local accounts (not OAuth). Revokes all tokens except current one for security.",
                "operationId": "141e4afbe7b6c73bcd252f096680adb5",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "current_password",
                                    "password",
                                    "password_confirmation"
                                ],
                                "properties": {
                                    "current_password": {
                                        "description": "Current password for verification",
                                        "type": "string",
                                        "format": "password",
                                        "example": "OldPass123!"
                                    },
                                    "password": {
                                        "description": "New password",
                                        "type": "string",
                                        "format": "password",
                                        "example": "NewSecurePass123!"
                                    },
                                    "password_confirmation": {
                                        "description": "Must match new password",
                                        "type": "string",
                                        "format": "password",
                                        "example": "NewSecurePass123!"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Password updated successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Contraseña actualizada exitosamente. Se cerraron todas las otras sesiones."
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "422": {
                        "description": "Validation error or OAuth account"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        }
    },
    "components": {
        "schemas": {
            "Customer": {
                "title": "Customer",
                "description": "Customer model with profile information and loyalty data",
                "properties": {
                    "id": {
                        "type": "integer",
                        "example": 1
                    },
                    "first_name": {
                        "type": "string",
                        "example": "Juan"
                    },
                    "last_name": {
                        "type": "string",
                        "example": "Pérez"
                    },
                    "full_name": {
                        "description": "Computed full name",
                        "type": "string",
                        "example": "Juan Pérez"
                    },
                    "email": {
                        "type": "string",
                        "format": "email",
                        "example": "juan@example.com"
                    },
                    "email_verified_at": {
                        "type": "string",
                        "format": "date-time",
                        "example": "2024-01-15T10:30:00Z",
                        "nullable": true
                    },
                    "avatar": {
                        "type": "string",
                        "example": "https://example.com/avatar.jpg",
                        "nullable": true
                    },
                    "oauth_provider": {
                        "type": "string",
                        "enum": [
                            "local",
                            "google"
                        ],
                        "example": "local"
                    },
                    "subway_card": {
                        "description": "Unique loyalty card number (10-12 digits)",
                        "type": "string",
                        "example": "802056895224"
                    },
                    "birth_date": {
                        "type": "string",
                        "format": "date",
                        "example": "1990-05-15",
                        "nullable": true
                    },
                    "gender": {
                        "type": "string",
                        "enum": [
                            "male",
                            "female",
                            "other"
                        ],
                        "example": "male",
                        "nullable": true
                    },
                    "phone": {
                        "description": "8-digit phone number (Guatemala)",
                        "type": "string",
                        "example": "12345678",
                        "nullable": true
                    },
                    "last_login_at": {
                        "type": "string",
                        "format": "date-time",
                        "example": "2024-01-20T15:45:00Z",
                        "nullable": true
                    },
                    "last_activity_at": {
                        "type": "string",
                        "format": "date-time",
                        "example": "2024-01-20T16:00:00Z",
                        "nullable": true
                    },
                    "last_purchase_at": {
                        "type": "string",
                        "format": "date-time",
                        "example": "2024-01-18T12:30:00Z",
                        "nullable": true
                    },
                    "points": {
                        "description": "Available loyalty points",
                        "type": "integer",
                        "example": 150
                    },
                    "points_updated_at": {
                        "type": "string",
                        "format": "date-time",
                        "example": "2024-01-18T12:30:00Z",
                        "nullable": true
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "active",
                            "inactive",
                            "suspended"
                        ],
                        "example": "active"
                    },
                    "is_online": {
                        "description": "True if customer is currently active",
                        "type": "boolean",
                        "example": true
                    },
                    "created_at": {
                        "type": "string",
                        "format": "date-time",
                        "example": "2024-01-10T08:00:00Z"
                    },
                    "updated_at": {
                        "type": "string",
                        "format": "date-time",
                        "example": "2024-01-20T15:45:00Z"
                    }
                },
                "type": "object"
            },
            "CustomerDevice": {
                "title": "CustomerDevice",
                "description": "Customer device registered for push notifications",
                "properties": {
                    "id": {
                        "type": "integer",
                        "example": 1
                    },
                    "customer_id": {
                        "type": "integer",
                        "example": 1
                    },
                    "sanctum_token_id": {
                        "type": "integer",
                        "example": 5,
                        "nullable": true
                    },
                    "fcm_token": {
                        "type": "string",
                        "example": "fKw8h4Xj...",
                        "nullable": true
                    },
                    "device_identifier": {
                        "type": "string",
                        "example": "550e8400-e29b-41d4-a716-446655440000"
                    },
                    "device_name": {
                        "type": "string",
                        "example": "iPhone 14 Pro de Juan",
                        "nullable": true
                    },
                    "last_used_at": {
                        "type": "string",
                        "format": "date-time",
                        "example": "2024-01-20T15:45:00Z",
                        "nullable": true
                    },
                    "is_active": {
                        "type": "boolean",
                        "example": true
                    },
                    "login_count": {
                        "type": "integer",
                        "example": 15
                    },
                    "is_current_device": {
                        "description": "True if this device is associated with current token",
                        "type": "boolean",
                        "example": true
                    },
                    "created_at": {
                        "type": "string",
                        "format": "date-time",
                        "example": "2024-01-10T08:00:00Z"
                    },
                    "updated_at": {
                        "type": "string",
                        "format": "date-time",
                        "example": "2024-01-20T15:45:00Z"
                    }
                },
                "type": "object"
            }
        },
        "securitySchemes": {
            "sanctum": {
                "type": "http",
                "description": "Laravel Sanctum Bearer Token. Obtain from /api/v1/auth/login, /api/v1/auth/register, or OAuth endpoints.",
                "bearerFormat": "JWT",
                "scheme": "bearer"
            }
        }
    },
    "tags": [
        {
            "name": "Authentication",
            "description": "Endpoints para registro, inicio de sesión, recuperación de contraseña y verificación de email"
        },
        {
            "name": "OAuth",
            "description": "Endpoints para autenticación con Google OAuth"
        },
        {
            "name": "Profile",
            "description": "Gestión del perfil del cliente"
        },
        {
            "name": "Devices",
            "description": "Gestión de dispositivos y tokens FCM para notificaciones push"
        }
    ]
}